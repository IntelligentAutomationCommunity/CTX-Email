[![](https://img.shields.io/badge/LinkedIn-Cortex-blue.svg?logo=linkedin)](https://www.linkedin.com/company/cortex-intelligent-automation-software/)
[![](https://img.shields.io/badge/Cortex-Blog-a0c326?logo=data:image/png;base64,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)](https://www.cortex-ia.com/latest-news-at-cortex/)


# CTX-Email
This repository contains flows and subtasks poll an IMAP Email Server for emails and to process each received email asynchronously in a separate flow

## CTX-Email-Get-Emails
This is the main flow to retrieve emails from an email IMAP server

### Inputs
- **i_config-area**: The name of an area in the [CTX-Configuration-Store](https://github.com/CortexIntelligentAutomation/CTX-Configuration-Store) containing the following configuration parameters:
  - **Server**: The FQDN of the IMAP server
  - **Port**: The port on the server to which Cortex must connect (Optional - defaults to *993*)
  - **Timeout**: The timeout in seconds before an attempt to connect to the server fails; a value of 0 means do not timeout (Optional - defaults to *0*)
  - **Secure-Connection** Specifies whether Transport Layer Security (TLS) is enabled for the IMAP connection (Optional - defaults to *true*)
  - **Username**: The email account username
  - **Password**: The email account password
  - **In-Folder**: The name of the folder containing emails to be processed by Cortex (Optional - defaults to *Inbox*)
  - **Retrieved-Folder**: The name of the folder into which emails downloaded by Cortex are moved before they are processed (Optional - defaults to *Retrieved*)
  - **Processed-Folder**: The name of the folder into which emails downloaded by Cortex are moved after they are processed (Optional - defaults to *Processed*)
  - **Attachment-Folder**: The name of a folder (directory) on the Cortex server to which email attachments are saved; all attachments in a single email are saved to the same, unique folder

### Processing
For each unread email in the **In-Folder** folder of the mainbox, Cortex will:
- Download the email
- Move the email to the **Processed** folder
- Asynchronously execute an instance of the CTX-Email-Process-Email flow

## CTX-Email-Process-Email
This flow is exected to process a single email message. The flow will:
- downloads any attachments to the **Attachment-Folder**/*flow-UUID* on the Cortex Server; this folder (directory) will be created if it does not exist
- determines how to handle the email
- if the email is successfully processed, moves the email to the **Processed-Folder** on the IMAP server (otherwise it is left in the **Retrived-Folder**)

### Processing emails
To process emails, modify the *process-Email* state of the flow. Inspect the email information contained in the **g_Message** structure to determine how to process the email.
Set the **g_Processed** boolean parameter to true if the email has been processed successfully.

It may be easier to perform the processing in another synchronously executed flow; this flow should accept the **g_Message** structure parameter as an input parameter, and return the **g_processed** boolean parameter as a return parameter.

# Installation Instructions
Download the Studio Package file and Import it into your Cortex Environment.
Don't forget to apply rights using the Studio Authorization module.

## Dependencies
This library depends upon the following libraries:
- [CTX-Configuration-Store](https://github.com/CortexIntelligentAutomation/CTX-Configuration-Store)
- [CTX-Logging](https://github.com/CortexIntelligentAutomation/CTX-Logging)
- [Cortex-Validate-Structure](https://github.com/IntelligentAutomationCommunity/Cortex-Validate-Structure)
- [CTX-IMAP-Extensions](https://github.com/CortexIntelligentAutomation/CTX-IMAP-Extensions)

:thumbsup: Enjoy! :wink:

